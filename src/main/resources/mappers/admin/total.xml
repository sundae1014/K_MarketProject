<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.kmarket.mapper.admin.TotalMapper">

    <select id="selectSalesByCategory" resultType="kr.co.kmarket.dto.ChartData">
        SELECT
        c.CATE_NAME AS label,
        COUNT(p.CATE_CD) AS value
        FROM ORDERDETAIL od
        JOIN PRODUCT p ON od.PROD_NUMBER = p.PROD_NUMBER
        JOIN CATEGORY c ON p.CATE_CD = c.CATE_CD
        GROUP BY c.CATE_NAME
        ORDER BY c.CATE_NAME
    </select>
    <select id="selectSalesByStatus" resultType="kr.co.kmarket.dto.ChartData">
        SELECT TO_CHAR(TRUNC(O_DATE), 'MM-DD') AS label,
        COUNT(*) AS value
        FROM "ORDER"
        WHERE O_DATE >= TRUNC(SYSDATE) - 4
        AND STAT = #{stat}
        GROUP BY TRUNC(O_DATE)
        ORDER BY TRUNC(O_DATE)
    </select>


    <select id="selectCountRegToday">
        SELECT COUNT(*)
        FROM member
        WHERE TRUNC("Date") = TRUNC(SYSDATE)
    </select>
    <select id="selectCountRegYesterday">
        SELECT COUNT(*)
        FROM member
        WHERE TRUNC("Date") = TRUNC(SYSDATE - 1)
    </select>

    <select id="selectPriceToday">
        SELECT NVL(SUM(od.PRICE * od.PIECE), 0)
        FROM "ORDER" o
        JOIN ORDERDETAIL od
        ON o.ORDER_NUMBER = od.ORDER_NUMBER
        WHERE TRUNC(o.O_DATE) = TRUNC(SYSDATE)
    </select>
    <select id="selectPriceYesterday">
        SELECT NVL(SUM(od.PRICE * od.PIECE), 0)
        FROM "ORDER" o
        JOIN ORDERDETAIL od
        ON o.ORDER_NUMBER = od.ORDER_NUMBER
        WHERE TRUNC(o.O_DATE) = TRUNC(SYSDATE) - 1
    </select>

    <select id="selectOrderToday">
        SELECT COUNT(*)
        FROM "ORDER"
        WHERE TRUNC(O_DATE) = TRUNC(SYSDATE)
    </select>
    <select id="selectOrderYesterday">
        SELECT COUNT(*)
        FROM "ORDER"
        WHERE TRUNC(O_DATE) = TRUNC(SYSDATE) - 1
    </select>

    <select id="selectPostToday">
        SELECT COUNT(*)
        FROM QNA
        WHERE
        TRUNC(REG_DATE) = TRUNC(SYSDATE)
    </select>
    <select id="selectPostYesterday">
        SELECT COUNT(*)
        FROM QNA
        WHERE
        TRUNC(REG_DATE) = TRUNC(SYSDATE - 1)
    </select>

    <select id="selectStatus">
        SELECT COUNT(*)
        FROM "ORDER"
        WHERE STAT = #{status}
    </select>

    <select id="selectQnq" resultType="kr.co.kmarket.dto.QnaDTO">
        SELECT id, title, reg_date, user_id
        FROM qna
        ORDER BY reg_date DESC
        FETCH FIRST 5 ROWS ONLY
    </select>

    <select id="selectNotice" resultType="kr.co.kmarket.dto.NoticeDTO">
        SELECT id, title, reg_date
        FROM notice
        ORDER BY reg_date DESC
        FETCH FIRST 5 ROWS ONLY
    </select>

</mapper>