<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.kmarket.mapper.admin.TotalMapper">

    <select id="selectSalesByCategory" resultType="kr.co.kmarket.dto.ChartData">
        SELECT
        c.CATE_NAME AS label,
        COUNT(p.CATE_CD) AS value
        FROM ORDERDETAIL od
        JOIN PRODUCT p ON od.PROD_NUMBER = p.PROD_NUMBER
        JOIN CATEGORY c ON p.CATE_CD = c.CATE_CD
        GROUP BY c.CATE_NAME
        ORDER BY c.CATE_NAME
    </select>
    <select id="selectSalesByStatus" resultType="kr.co.kmarket.dto.ChartData">
        SELECT TO_CHAR(TRUNC(O_DATE), 'MM-DD') AS label,
        COUNT(*) AS value
        FROM "Order"
        WHERE O_DATE >= TRUNC(SYSDATE) - 4
        AND STAT = #{stat}
        GROUP BY TRUNC(O_DATE)
        ORDER BY TRUNC(O_DATE)
    </select>


    <select id="selectCountRegToday">
        SELECT COUNT(*)
        FROM member
        WHERE TRUNC("Date") = TRUNC(SYSDATE)
    </select>
    <select id="selectCountRegYesterday">
        SELECT COUNT(*)
        FROM member
        WHERE TRUNC("Date") = TRUNC(SYSDATE - 1)
    </select>

    <select id="selectPriceToday">
        SELECT NVL(SUM(od.PRICE * od.PIECE), 0)
        FROM "Order" o
        JOIN ORDERDETAIL od
        ON o.ORDERNUMBER = od.ORDERNUMBER
        WHERE TRUNC(o.O_DATE) = TRUNC(SYSDATE)
    </select>
    <select id="selectPriceYesterday">
        SELECT NVL(SUM(od.PRICE * od.PIECE), 0)
        FROM "Order" o
        JOIN ORDERDETAIL od
        ON o.ORDERNUMBER = od.ORDERNUMBER
        WHERE TRUNC(o.O_DATE) = TRUNC(SYSDATE) - 1
    </select>

    <select id="selectOrderToday">
        SELECT COUNT(*)
        FROM "Order"
        WHERE TRUNC(O_DATE) = TRUNC(SYSDATE)
    </select>
    <select id="selectOrderYesterday">
        SELECT COUNT(*)
        FROM "Order"
        WHERE TRUNC(O_DATE) = TRUNC(SYSDATE) - 1
    </select>

    <select id="selectPostToday">
        SELECT COUNT(*)
        FROM CSBOARD b
        JOIN CS c
        ON b.CS_CD = c.CS_CD
        WHERE c.UP_CS_CD = 3
        AND TRUNC(b.W_DATE) = TRUNC(SYSDATE)
    </select>
    <select id="selectPostYesterday">
        SELECT COUNT(*)
        FROM CSBOARD b
        JOIN CS c
        ON b.CS_CD = c.CS_CD
        WHERE c.UP_CS_CD = 3
        AND TRUNC(b.W_DATE) = TRUNC(SYSDATE - 1)
    </select>

    <select id="selectStatus">
        SELECT COUNT(*)
        FROM "Order"
        WHERE STAT = #{status}
    </select>
</mapper>